<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forsyth Games | Games</title>
    <link rel="stylesheet" href="./all.css?login.live.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="page">
        <h1 class="center">All Games</h1>

        <div class="search-bar">
            <i class="fas fa-search search-icon" aria-hidden="true"></i>
            <input id="search" type="text" placeholder="Search Games...">
        </div>

        <div class="items-container">
            <div id="itemList"></div>
            <div id="no-results" class="hidden">
                <img src="./assets/invalid-search.png?login.live.com" alt="No Search Results">
                <p>No games match your query. Please check your spelling or adjust your search term.</p>
            </div>
        </div>
    </div>

    <script src="./games/games.js?login.live.com"></script>
    <script src="./search.js?login.live.com"></script>
    <script>
        (function() {
            'use strict';

            const searchEl = document.getElementById('search');
            const listEl = document.getElementById('itemList');
            const noResultsEl = document.getElementById('no-results');

            // Apply saved theme and animations on load
            document.body.className = localStorage.getItem('celestrium-theme') || 'light';
            
            initializeSearch(games, searchEl, listEl, noResultsEl);

            // Tell parent we're loaded so it can send current state
            window.parent.postMessage({type: 'pageLoaded'}, '*');

            // Listen for theme and animations changes from parent
            window.addEventListener('message', (e) => {
                if (e.data.type === 'themeChange') {
                    document.body.className = e.data.theme;
                } else if (e.data.type === 'animationsChange') {
                    toggleAnimations(e.data.enabled);
                }
            });
        })();
    </script>
    <script>
        (function(){
            function normalizeKeyName(key) {
                if (!key) return null;
                const s = key.toLowerCase();
                if (s === ' ') return 'space';
                if (s === 'esc') return 'escape';
                if (s === 'return') return 'enter';
                if (s === 'arrowleft' || s === 'arrowright' || s === 'arrowup' || s === 'arrowdown') return s;
                if (s === 'control' || s === 'ctrl' || s === 'shift' || s === 'alt' || s === 'meta') return null;
                if (/^f\d{1,2}$/.test(s)) return s;
                return s.length === 1 ? s : s;
            }
            function normalizeFromCode(code) {
                if (!code) return null;
                if (/^Key[A-Z]$/.test(code)) return code.slice(3).toLowerCase();
                if (/^Digit[0-9]$/.test(code)) return code.slice(5);
                return null;
            }
            function matchesKeybind(e, kb) {
                if (!kb || !kb.key) return false;
                const k = normalizeFromCode(e.code) || normalizeKeyName(e.key);
                return k === kb.key && e.ctrlKey === !!kb.ctrl && e.metaKey === !!kb.meta && e.altKey === !!kb.alt && e.shiftKey === !!kb.shift;
            }
            document.addEventListener('keydown', e => {
                const kbJSON = localStorage.getItem('celestrium-keybind');
                const kb = kbJSON ? JSON.parse(kbJSON) : null;
                if (matchesKeybind(e, kb)) {
                    try { window.parent.postMessage({type: 'triggerKeybind'}, '*'); } catch {}
                }
            });
        })();
    </script>
</body>
</html>
